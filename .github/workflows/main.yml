name: Trigger GitLab CI

on:
  push:
    branches:
      - main
  create:
    branches:
      - '*'

jobs:
  trigger-gitlab-ci:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger GitLab CI
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            REF="main"
          elif [ "${{ github.event_name }}" = "create" ]; then
            REF="${{ github.event.ref }}"
          else
            echo "Unsupported event: ${{ github.event_name }}"
            exit 1
          fi

          curl --request POST \
            --header "PRIVATE-TOKEN: $GITLAB_CI_TOKEN" \
            --url "https://gitlab.com/api/v4/projects/48639908/trigger/pipeline" \
            --form "ref=${REF}" \
            --form "token=$GITLAB_CI_TRIGGER_TOKEN"
